<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="all-summary">
	<link rel="import" type="css" href="all-summary.css">

	<template>
		<div id="loading" hidden$="[[!isLoading]]">
			<paper-spinner alt="Loading resource list" active></paper-spinner>
		</div>
		<div id="cards" hidden$="[[isLoading]]">
			<template is="dom-repeat" items="[[sites]]" as="site">
				<paper-card heading="[[site.name]]"> 
					<template is="dom-repeat" items="[[site.locations]]" as="location">
						<div class="list" role="list">
							<usage-summary name="[[location.name]]" free="{{freeResources(location.resources)}}"
							             total="[[totalResources(location.resources)]]"></usage-summary>
						</div>
					</template>
				</paper-card>
			</template>
		</div>

		<iron-media-query query="(max-width: 1280px)" query-matches="{{_isLarge}}"></iron-media-query>
		<iron-media-query query="(max-width: 780px)" query-matches="{{_isMobile}}"></iron-media-query>
	</template>

	<script>
		(function() {
		'use strict';
			Polymer({
				is: 'all-summary',
	
				properties: {
					sites: {
						type: Object,
						value: []
					},

					isLoading: {
						type: Boolean,
						value: true
					},

					_isLarge: {
						type: Boolean,
						observer: '_isLargeChanged'
					},

					_isMobile: {
						type: Boolean,
						observer: '_isMobileChanged'
					}
				},

				_isLargeChanged: function(isLarge) {
					this.$.cards.style.WebkitColumnCount = isLarge ? 2 : 3;
					this.$.cards.style.MozColumnCount    = isLarge ? 2 : 3;
					this.$.cards.style.columnCount       = isLarge ? 2 : 3;

					this.updateStyles();
				},

				_isMobileChanged: function(isMobile) {
					this.$.cards.style.width = isMobile ? '100%' : '80%';
					this.$.cards.style.WebkitColumnCount = isMobile ? 1 : 3;
					this.$.cards.style.MozColumnCount = isMobile ? 1 : 3;
					this.$.cards.style.columnCount = isMobile ? 1 : 3;

					this.updateStyles();

					/*this.$.
					this.mainMode = isMobile ? 'seamed' : 'cover';
					this.drawerWidth = isMobile ? '100%' : '320px';
					this.toolbarClass = isMobile ? '' : 'tall';
					this.updateStyles();*/
				},

				freeResources: function(resources) {
					var free = 0;

					for (var i in resources) {
						var resource = resources[i];
						if (resource.state === 'AVAILABLE') {
							free += 1;
						}
					}

					return free;
				},

				totalResources: function(resources) {
					return resources.length;
				},
			});
		})();
	</script>
</dom-module>
