<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">

<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">

<link rel="import" href="../routing.html">

<link rel="import" href="../all-summary/all-summary.html">
<link rel="import" href="../site-list/site-list.html">
<link rel="import" href="../site-explore/site-explore.html">
<link rel="import" href="../bookit-data/bookit-data.html">
<link rel="import" href="../bookit-list/bookit-list.html">
<link rel="import" href="../bookit-map/bookit-map.html">

<dom-module id="mapit-app">
	<link rel="import" type="css" href="mapit-app.css">

	<template>
		<bookit-data data="{{sites}}" is-loading="{{isLoading}}" refresh="{{refresh}}"></bookit-data>

		<paper-drawer-panel id="navDrawerPanel" responsive-width="1280px">
			<div class="nav" drawer>
				<paper-toolbar id="drawerToolbar"></paper-toolbar>
				<site-list></site-list>
			</div>

			<div main>
				<div id="wrapper" style="display: flex; flex-direction: column; height: 100%;">
					<paper-toolbar id="pageToolbar" class="mainToolbar">
						<paper-icon-button id="menu_btn" icon="menu" hidden="[[!_showMenuBtn]]" paper-drawer-toggle></paper-icon-button>

						<span class="title flex" hidden="[[_searching]]">{{title}}</span>
						<paper-input class="flex" no-label-float label="Enter a resource" hidden="[[!_searching]]"></paper-input>
	
						<paper-icon-button icon="refresh" on-tap="_tapRefresh"></paper-icon-button>
						<paper-icon-button icon="search" on-tap="_tapSearch"></paper-icon-button>
          				</paper-toolbar>

					<iron-pages id="iPages" class="flex" attr-for-selected="data-section" selected="0">
						<all-summary  class="flex" data-section="summary" sites="[[sites]]" id="allLibSum" is-loading="[[isLoading]]"></all-summary>
						<site-explore class="flex" data-section="library" site="[[site]]" sites="[[sites]]" is-loading="[[isLoading]]"></site-explorer>
					</iron-pages>
				</div>
			</div>
		</paper-drawer-panel>
		
		<paper-toast id="routeToast"></paper-toast>
		<paper-toast id="refreshToast" text="Refreshed data."></paper-toast>

		<iron-media-query query="(max-width: 1280px)" query-matches="{{_showMenuBtn}}"></iron-media-query>
	</template>

	<script>
		(function() {
                        'use strict';

			Polymer({
				is: 'mapit-app',

				properties: {
					title: {
						type: String,
						value: 'MapIT'
					},
					site: {
						type: String,
						value: null
					},

					_searching: {
						type: Boolean,
						value: false
					}
				},
				behaviors: [
					Polymer.IronResizableBehavior
				],

				attached: function() {
					var that = this;
					setInterval(function() {
						that.refresh = true;
					}, 60000);

					document.querySelector('site-list').addEventListener('tap-item', function() {
						that.$.navDrawerPanel.closeDrawer();
					});
				},

				_onMainDrawerSelect: function(e, detail) {
					var librarySelected = document.getElementById('iPages').selected === 'library';

					if (detail.item.id === 'main' || detail.item.id === 'drawer') {
						var hidden = !(detail.item.id === 'main' && librarySelected);
						document.getElementById('back_arrow').hidden = hidden;

						if (hidden) {
							document.getElementById('menu_btn').style.display = 'block';
						} else {
							document.getElementById('menu_btn').style.display = 'none';
						}
					}
				},

				_tapRefresh: function() {
					this.refresh = true;
				},

				_tapSearch: function() {
					this._searching = !this._searching;
				}
			});
		})();
	</script>
</dom-module>
