<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../../bower_components/resource-map/resource-map.html">

<dom-module id="bookit-map">
	<template>
		<style>
			:host {
				display: block;
				height: 100%;
			}

			#container {
				display: flex;
				height: 100%;
				align-items: center;
				justify-content: center;

				background-color: #E0E0E0;
				font-size: 24px;
			}

			#map {
				width: 100%;
				height: 100%;
				overflow: hidden;
			}
		</style>

		<div id="container">
			<div id="map" on-track="_handleMapTrack" on-scroll="_handleMapScroll">
				<div>Map for <span>[[site]]</span></div>
			</div>
		</div>
	</template>
	
	<script>
		(function() {
			'use strict';

			Polymer({
				is: 'bookit-map',

				properties: {
					site: {
						type: String,
						observer: '_siteChanged'
					},
					map: {
						type: Object,
						notify: true,
						value: null
					},
					xPos: {
						type: Number,
						value: 0,
						notify: true,
						reflectToAttribute: true
					},
					yPos: {
						type: Number,
						value: 0,
						notify: true,
						reflectToAttribute: true
					},
					zoom: {
						type: Number,
						value: 1.0,
						observer: '_zoomChanged',
						notify: true
					},
					maxZoom: {
						type: Number,
						value: 10.0,
						notify: true
					},
					minZoom: {
						type: Number,
						value: 0.2,
						notify: true
					}
				},

				behaviors: [
					Polymer.IronResizableBehavior
				],
				listeners: {
					'iron-resize': 'resize'
				},

				attached: function() {
					this._initMap();
				},

				_initMap: function() {
					if (this.map) {
						console.log('Map already initialized.');
						return;
					}
					if (!this.isAttached) {
						console.log('Map is not attached.');
						return;
					}
					/*global ResourceMap */
					this.map = new ResourceMap(this.site);
				},

				_zoomChanged: function() {
					if (this.map) {
						this.map.setZoom(Number(this.zoom));
					}
				},

				_siteChanged: function(newSite, oldSite) {
					console.log('Site changed from ' + oldSite + ' to ' + newSite);
					this._initMap();
				},

				_handleMapTrack: function(e) {
					switch(e.detail.state) {
						case 'start':
							console.log('Tracking started!');
							break;
						case 'track':
							console.log('Tracking in progress... ' +
							e.detail.x + ', ' + e.detail.y);
							this.map.movePosition(e.detail.ddx, e.detail.ddy);
							break;
						case 'end':
							console.log('Tracking ended!');
							break;
					}
				},

				_handleMapScroll: function(e) {
					console.log(e);
				},

				resize: function() {
					if(this.map) {
						this.map.resizeCanvas();
						
					}
				}
			});
		})();
	</script>
</dom-module>
