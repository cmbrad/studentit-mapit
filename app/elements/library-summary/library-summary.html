<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="library-summary">
	<template>
		<style>
			:host {
				display: block;
				height: 100vh;
				overflow: scroll;
			}

			#cards {
				@apply(--layout-vertical);
				@apply(--center-justified);
				max-width: 600px;
				margin-left: auto;
				margin-right: auto;

				padding-top: 24px;
				padding-bottom: 24px;
			}

			paper-card {
				width: 100%;
				margin-bottom: 16px;
			}

		</style>

		<div id="cards">
			<template is="dom-repeat" items="[[sites]]" as="site">
				<paper-card heading="[[site.name]]"> 
					<template is="dom-repeat" items="[[site.locations]]" as="location">
						<div class="list" role="list">
							<usage-summary name="[[location.name]]" free="{{freeResources(location.resources)}}"
							             total="[[totalResources(location.resources)]]"></usage-summary>
						</div>
					</template>
				</paper-card>
			</template>
		</div>

	</template>

	<script>
		(function() {
		'use strict';
	
			Polymer({
				is: 'library-summary',
	
				properties: {
					sites: {
						type: Object
					}
				},

				freeResources: function(resources) {
					var free = 0;

					for (var i in resources) {
						var resource = resources[i];
						if (resource.state === 'AVAILABLE') {
							free += 1;
						}
					}

					return free;
				},

				totalResources: function(resources) {
					return resources.length;
				},
			});
		})();
	</script>
</dom-module>
