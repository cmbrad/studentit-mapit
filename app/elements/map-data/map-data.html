<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="map-data">
	<template>
		<iron-ajax
			id="data"
			url="[[_url]]"
			params="[[_params]]"
			handle-as="json"
			last-error="{{dataError}}"
			last-response="{{dataResponse}}">
		</iron-ajax>
	</template>

	<script>
		(function() {
			'use strict';

			Polymer({
				is: 'map-data',

				properties: {
					site: {
						type: String,
						observer: '_siteChanged'
					},
					dataError: {
						type: Object,
						notify: true
					},
					dataResponse: {
						type: Object,
						notify: true
					},
					_params: {
						type: Object
					},
					_url: {
						type: String
					}
				},

				_siteChanged: function(site) {
					if (!site || site === '') {
						return;
					}
					// Generate timestamp
					var today = new Date();
					var dd = today.getDate();
					var mm = today.getMonth() + 1;
					var yyyy = today.getFullYear();

					this._url = 'http://mapit.cy.id.au/maps/' + site + '.json';

					this._params = {
						timestamp: ('' + mm + dd + yyyy)
					};

					this.$.data.generateRequest();
				}
			});
		})();
	</script>
</dom-module>
